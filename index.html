<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mydeal - Ù†Ø¸Ø§Ù… ØªØ¬Ø§Ø±Ø© Ø§Ù„ÙˆØ±Ù‚Ø¹ </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Ø¥Ø¶Ø§ÙØ© Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        /* Ù†ÙØ³ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© */
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            direction: rtl;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background-color: white;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            color: var(--secondary);
            font-size: 28px;
        }

        .logo h1 {
            font-size: 24px;
            color: var(--primary);
        }

        .logo span {
            color: var(--secondary);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }

        nav a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
            padding: 5px 0;
            position: relative;
        }

        nav a:hover {
            color: var(--secondary);
        }

        .btn {
            display: inline-block;
            background-color: var(--secondary);
            color: white;
            padding: 12px 30px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            font-size: 16px;
        }

        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: var(--accent);
        }

        .btn-warning {
            background-color: var(--warning);
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-whatsapp {
            background-color: #25D366;
        }

        .btn-whatsapp:hover {
            background-color: #128C7E;
        }

        .section-title {
            text-align: center;
            margin: 60px 0 40px;
            color: var(--primary);
        }

        .product-selector {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 40px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .price-display {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--secondary);
        }

        .price-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent);
        }

        .dimensions-info {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .dimension {
            background-color: white;
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .dimension span {
            font-weight: 600;
            color: var(--primary);
        }

        .calculation-steps {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-right: 4px solid var(--success);
        }

        .calculation-steps h4 {
            margin-bottom: 10px;
            color: var(--primary);
        }

        .step {
            margin: 5px 0;
            padding: 5px;
            background: white;
            border-radius: 4px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: var(--shadow);
            z-index: 1001;
            display: none;
            max-width: 300px;
        }

        .notification.error {
            background-color: var(--accent);
        }

        .admin-panel {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 60px;
        }

        .product-card {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: white;
        }

        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .login-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 100%;
            max-width: 400px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--secondary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .payment-section {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 40px;
        }

        .payment-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .payment-step {
            flex: 1;
            min-width: 250px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            transition: var(--transition);
        }

        .payment-step:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .step-icon {
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 15px;
        }

        .payment-step h4 {
            margin-bottom: 10px;
            color: var(--primary);
        }

        .vodafone-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent);
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Notifications -->
    <div class="notification" id="notification">
        <i class="fas fa-bell"></i> <span id="notification-text"></span>
    </div>

    <!-- Loading -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
    </div>

    <!-- Login Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-content">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
            <div class="form-group">
                <label for="adminEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <input type="email" id="adminEmail" class="form-control" placeholder="admin@mydeal.com">
            </div>
            <div class="form-group">
                <label for="adminPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="adminPassword" class="form-control" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            <button class="btn" onclick="adminLogin()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <button class="btn btn-danger" onclick="closeLogin()" style="margin-top: 10px;">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-scroll"></i>
                    <h1>Mydeal <span>Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„ÙˆØ±Ù‚</span></h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="#home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                        <li><a href="#products">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a></li>
                        <li><a href="#payment">Ø§Ù„Ø¯ÙØ¹</a></li>
                        <li><a href="#" id="adminLink">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a></li>
                        <li><a href="#" id="logoutLink" style="display: none;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <section id="home">
        <div class="container">
            <div class="section-title">
                <h2>Ù…ØªØ¬Ø± ÙˆØ±Ù‚ ÙˆØ§Ø³ØªÙŠÙƒØ±Ø§Øª MyDeal</h2>
                <p>ØªØ³ÙˆÙ‚ ÙˆØ§Ø´ØªØ±ÙŠ Ø§Ù„Ø§Ù† Ø¨Ø§Ø³Ø¹Ø§Ø± ØªÙ†Ø§ÙØ³ÙŠØ©</p>
            </div>

            <div class="product-selector">
                <div class="form-group">
                    <label for="productType">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬</label>
                    <select id="productType" class="form-control">
                        <option value="">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="length">Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)</label>
                    <input type="number" id="length" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø·ÙˆÙ„ Ø¨Ø§Ù„Ø³Ù†ØªÙŠÙ…ØªØ±">
                </div>

                <div class="form-group">
                    <label for="width">Ø§Ù„Ø¹Ø±Ø¶ (Ø³Ù…)</label>
                    <input type="number" id="width" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø§Ù„Ø³Ù†ØªÙŠÙ…ØªØ±">
                </div>

                <div class="form-group">
                    <label for="quantity">Ø§Ù„ÙƒÙ…ÙŠØ© (Ø§Ø³ØªÙŠÙƒØ±)</label>
                    <select id="quantity" class="form-control">
                        <option value="1000">1000 Ø§Ø³ØªÙŠÙƒØ± (Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¹Ø§Ø¯ÙŠ)</option>
                        <option value="500">500 Ø§Ø³ØªÙŠÙƒØ± (Ù†ØµÙ Ø§Ù„Ø³Ø¹Ø±)</option>
                        <option value="2000">2000 Ø§Ø³ØªÙŠÙƒØ± (Ø¶Ø¹Ù Ø§Ù„Ø³Ø¹Ø±)</option>
                    </select>
                </div>

                <button class="btn" onclick="calculatePrice()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±</button>

                <div class="price-display">
                    <h3>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</h3>
                    <div class="price-value" id="priceValue">0 Ø¬Ù†ÙŠÙ‡</div>
                    <div class="dimensions-info">
                        <div class="dimension">Ø§Ù„Ø·ÙˆÙ„: <span id="selectedLength">-</span></div>
                        <div class="dimension">Ø§Ù„Ø¹Ø±Ø¶: <span id="selectedWidth">-</span></div>
                        <div class="dimension">Ø§Ù„ÙƒÙ…ÙŠØ©: <span id="selectedQuantity">-</span></div>
                        <div class="dimension">Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±: <span id="pricePerMeter">-</span></div>
                    </div>
                    
                    <div class="calculation-steps" id="calculationSteps" style="display: none;">
                        <h4>Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨:</h4>
                        <div id="stepsContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Payment Section -->
    <section id="payment">
        <div class="container">
            <div class="section-title">
                <h2>Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</h2>
                <p>Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù†</p>
            </div>

            <div class="payment-section">
                <div class="payment-steps">
                    <div class="payment-step">
                        <div class="step-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <h4>Ø§Ù„Ø®Ø·ÙˆØ© 1</h4>
                        <p>Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø£Ø¹Ù„Ø§Ù‡</p>
                    </div>
                    <div class="payment-step">
                        <div class="step-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h4>Ø§Ù„Ø®Ø·ÙˆØ© 2</h4>
                        <p>Ù‚Ù… Ø¨Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø±Ù‚Ù… ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´ Ø§Ù„ØªØ§Ù„ÙŠ:</p>
                        <div class="vodafone-number">01008559292</div>
                    </div>
                    <div class="payment-step">
                        <div class="step-icon">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <h4>Ø§Ù„Ø®Ø·ÙˆØ© 3</h4>
                        <p>Ø£Ø±Ø³Ù„ Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</p>
                        <button class="btn btn-whatsapp" id="whatsappBtn" onclick="sendWhatsAppMessage()" disabled>
                            <i class="fab fa-whatsapp"></i> Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
                        </button>
                    </div>
                    <div class="payment-step">
                        <div class="step-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h4>Ø§Ù„Ø®Ø·ÙˆØ© 4</h4>
                        <p>Ø³Ù†Ù‚ÙˆÙ… Ø¨ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Admin Section -->
    <section id="adminSection" style="display: none;">
        <div class="container">
            <div class="section-title">
                <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Firebase</h2>
                <p>Ø¥Ø¯Ø§Ø±Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª</p>
            </div>

            <div class="admin-panel">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalProducts">0</div>
                        <div>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalOrders">0</div>
                        <div>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalRevenue">0</div>
                        <div>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ø¬Ù†ÙŠÙ‡)</div>
                    </div>
                </div>

                <div class="form-group">
                    <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
                    <input type="text" id="newProductName" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" style="margin-bottom: 10px;">
                    <select id="newProductType" class="form-control" style="margin-bottom: 10px;">
                        <option value="thermal">ÙˆØ±Ù‚ Ø­Ø±Ø§Ø±ÙŠ</option>
                        <option value="wax">Ø±ÙŠØ¨ÙˆÙ† Ø´Ù…Ø¹ÙŠ</option>
                        <option value="resin">Ø±ÙŠØ¨ÙˆÙ† Ø±ÙŠØ²ÙŠÙ†</option>
                        <option value="wax-resin">Ø±ÙŠØ¨ÙˆÙ† Ø´Ù…Ø¹ÙŠ Ø±ÙŠØ²ÙŠÙ†</option>
                        <option value="white">ÙˆØ±Ù‚ Ø£Ø¨ÙŠØ¶ Ù†ØµÙ Ù„Ø§Ù…Ø¹</option>
                        <option value="plastic">Ø¨Ù„Ø§Ø³ØªÙŠÙƒ</option>
                    </select>
                    <input type="number" id="newProductPrice" class="form-control" placeholder="Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±" step="0.01" style="margin-bottom: 10px;">
                    <button class="btn btn-success" onclick="addProduct()">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
                </div>

                <div id="productsList" style="margin-top: 30px;">
                    <h3>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
                    <div id="productsContainer"></div>
                </div>

                <div id="ordersList" style="margin-top: 30px;">
                    <h3>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</h3>
                    <div id="ordersContainer"></div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // ğŸ”¥ Firebase Configuration - Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ
        const firebaseConfig = {
            apiKey: "AIzaSyBznBqyjqA87Jp7hQakRgg4okOk6eXxw1E",
            authDomain: "mydeal-6b90d.firebaseapp.com",
            databaseURL: "https://mydeal-6b90d-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "mydeal-6b90d",
            storageBucket: "mydeal-6b90d.firebasestorage.app",
            messagingSenderId: "1026430553997",
            appId: "1:1026430553997:web:3f66722a15a0f87cf9b7c4",
            measurementId: "G-QL9K1RRTL2"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log('âœ… Firebase initialized successfully');
        } catch (error) {
            console.error('âŒ Firebase initialization error:', error);
        }
        
        const db = firebase.firestore();

        // Global Variables
        let products = [];
        let orders = [];
        let isAdminLoggedIn = false;
        let currentUser = null;
        let currentOrder = null;
        let isFirebaseConnected = false;

        // DOM Elements
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');
        const loadingElement = document.getElementById('loading');
        const loginModal = document.getElementById('loginModal');
        const adminSection = document.getElementById('adminSection');
        const adminLink = document.getElementById('adminLink');
        const logoutLink = document.getElementById('logoutLink');
        const whatsappBtn = document.getElementById('whatsappBtn');

        // Local Storage Fallback
        const STORAGE_KEYS = {
            PRODUCTS: 'mydeal_products',
            ORDERS: 'mydeal_orders',
            ADMIN_LOGGED_IN: 'mydeal_admin_logged_in'
        };

        // ğŸ”¥ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Firebase
        function checkFirebaseConnection() {
            return new Promise((resolve) => {
                const testDoc = db.collection('test').doc('connection');
                testDoc.set({ test: true }, { merge: true })
                    .then(() => {
                        console.log('âœ… Firebase connection successful');
                        isFirebaseConnected = true;
                        resolve(true);
                    })
                    .catch((error) => {
                        console.error('âŒ Firebase connection failed:', error);
                        isFirebaseConnected = false;
                        resolve(false);
                    });
            });
        }

        // ğŸ”¥ Firebase Functions
        async function loadProducts() {
            try {
                showLoading();
                
                // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø£ÙˆÙ„Ø§Ù‹
                const connected = await checkFirebaseConnection();
                
                if (connected) {
                    const snapshot = await db.collection('products').get();
                    products = snapshot.docs.map(doc => ({
                        _id: doc.id,
                        ...doc.data()
                    }));
                    
                    if (products.length === 0) {
                        await addDefaultProducts();
                        await loadProducts();
                    } else {
                        populateProductSelect();
                        if (isAdminLoggedIn) {
                            loadAdminProducts();
                        }
                    }
                    showNotification('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Firebase');
                } else {
                    throw new Error('No Firebase connection');
                }
            } catch (error) {
                console.error('Error loading products:', error);
                showNotification('âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© - ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ§Ø¹Ø¯ Firebase', true);
                products = getDefaultProducts();
                populateProductSelect();
            } finally {
                hideLoading();
            }
        }

        async function addDefaultProducts() {
            const defaultProducts = [
                { name: 'ÙˆØ±Ù‚ Ø­Ø±Ø§Ø±ÙŠ Ø¹Ø§Ø¯ÙŠ', type: 'thermal', price: 32, active: true, createdAt: new Date().toISOString() },
                { name: 'Ø±ÙŠØ¨ÙˆÙ† Ø´Ù…Ø¹ÙŠ', type: 'wax', price: 11, active: true, createdAt: new Date().toISOString() },
                { name: 'Ø±ÙŠØ¨ÙˆÙ† Ø±ÙŠØ²ÙŠÙ†', type: 'resin', price: 15, active: true, createdAt: new Date().toISOString() },
                { name: 'Ø±ÙŠØ¨ÙˆÙ† Ø´Ù…Ø¹ÙŠ Ø±ÙŠØ²ÙŠÙ†', type: 'wax-resin', price: 18, active: true, createdAt: new Date().toISOString() },
                { name: 'ÙˆØ±Ù‚ Ø£Ø¨ÙŠØ¶ Ù†ØµÙ Ù„Ø§Ù…Ø¹', type: 'white', price: 28, active: true, createdAt: new Date().toISOString() },
                { name: 'Ø¨Ù„Ø§Ø³ØªÙŠÙƒ Ù„Ø§Ù…Ø¹', type: 'plastic', price: 35, active: true, createdAt: new Date().toISOString() }
            ];

            try {
                for (const product of defaultProducts) {
                    await db.collection('products').add(product);
                }
                console.log('âœ… Default products added successfully');
            } catch (error) {
                console.error('Error adding default products:', error);
                throw error;
            }
        }

        async function addProduct() {
            const name = document.getElementById('newProductName').value;
            const type = document.getElementById('newProductType').value;
            const price = parseFloat(document.getElementById('newProductPrice').value);

            if (!name || !price) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', true);
                return;
            }

            const productData = {
                name: name,
                type: type,
                price: price,
                active: true,
                createdAt: new Date().toISOString()
            };

            try {
                showLoading();
                
                if (isFirebaseConnected) {
                    await db.collection('products').add(productData);
                    showNotification('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Firebase Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
                    const localProducts = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS) || '[]');
                    productData._id = Date.now().toString();
                    localProducts.push(productData);
                    localStorage.setItem(STORAGE_KEYS.PRODUCTS, JSON.stringify(localProducts));
                    showNotification('âš ï¸ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø­Ù„ÙŠØ§Ù‹', true);
                }
                
                document.getElementById('newProductName').value = '';
                document.getElementById('newProductPrice').value = '';
                await loadProducts();
            } catch (error) {
                console.error('Error adding product:', error);
                showNotification('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬', true);
            } finally {
                hideLoading();
            }
        }

        async function deleteProduct(productId) {
            try {
                showLoading();
                
                if (isFirebaseConnected) {
                    await db.collection('products').doc(productId).delete();
                    showNotification('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Firebase');
                } else {
                    // Ø­Ø°Ù Ù…Ø­Ù„ÙŠ
                    const localProducts = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS) || '[]');
                    const updatedProducts = localProducts.filter(p => p._id !== productId);
                    localStorage.setItem(STORAGE_KEYS.PRODUCTS, JSON.stringify(updatedProducts));
                    showNotification('âš ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø­Ù„ÙŠØ§Ù‹', true);
                }
                
                await loadProducts();
            } catch (error) {
                console.error('Error deleting product:', error);
                showNotification('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬', true);
            } finally {
                hideLoading();
            }
        }

        async function loadOrders() {
            try {
                if (isFirebaseConnected) {
                    const snapshot = await db.collection('orders').orderBy('createdAt', 'desc').limit(10).get();
                    orders = snapshot.docs.map(doc => ({
                        _id: doc.id,
                        ...doc.data()
                    }));
                } else {
                    orders = getLocalOrders();
                }
                
                if (isAdminLoggedIn) {
                    loadAdminOrders();
                    updateStats();
                }
            } catch (error) {
                console.error('Error loading orders:', error);
                orders = getLocalOrders();
            }
        }

        async function createOrder(orderData) {
            try {
                if (isFirebaseConnected) {
                    await db.collection('orders').add(orderData);
                    showNotification('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Firebase Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    saveOrderLocally(orderData);
                    showNotification('âš ï¸ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹ - ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', true);
                }
                
                currentOrder = orderData;
                whatsappBtn.disabled = false;
                await loadOrders();
            } catch (error) {
                console.error('Error creating order:', error);
                saveOrderLocally(orderData);
                currentOrder = orderData;
                whatsappBtn.disabled = false;
                showNotification('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ - ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹', true);
            }
        }

        function getDefaultProducts() {
            return [
                { _id: '1', name: 'ÙˆØ±Ù‚ Ø­Ø±Ø§Ø±ÙŠ Ø¹Ø§Ø¯ÙŠ', type: 'thermal', price: 32, active: true },
                { _id: '2', name: 'Ø±ÙŠØ¨ÙˆÙ† Ø´Ù…Ø¹ÙŠ', type: 'wax', price: 11, active: true },
                { _id: '3', name: 'Ø±ÙŠØ¨ÙˆÙ† Ø±ÙŠØ²ÙŠÙ†', type: 'resin', price: 15, active: true },
                { _id: '4', name: 'Ø±ÙŠØ¨ÙˆÙ† Ø´Ù…Ø¹ÙŠ Ø±ÙŠØ²ÙŠÙ†', type: 'wax-resin', price: 18, active: true },
                { _id: '5', name: 'ÙˆØ±Ù‚ Ø£Ø¨ÙŠØ¶ Ù†ØµÙ Ù„Ø§Ù…Ø¹', type: 'white', price: 28, active: true },
                { _id: '6', name: 'Ø¨Ù„Ø§Ø³ØªÙŠÙƒ Ù„Ø§Ù…Ø¹', type: 'plastic', price: 35, active: true }
            ];
        }

        function getLocalOrders() {
            return JSON.parse(localStorage.getItem(STORAGE_KEYS.ORDERS) || '[]');
        }

        function saveOrderLocally(orderData) {
            const orders = getLocalOrders();
            orders.push(orderData);
            localStorage.setItem(STORAGE_KEYS.ORDERS, JSON.stringify(orders));
        }

        // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ...
        // [Admin Functions, Authentication, Price Calculation, etc.]

        // ğŸ”¥ Admin Functions
        function loadAdminProducts() {
            const container = document.getElementById('productsContainer');
            container.innerHTML = '';

            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <h4>${product.name}</h4>
                    <p>Ø§Ù„Ù†ÙˆØ¹: ${getProductTypeName(product.type)}</p>
                    <p>Ø§Ù„Ø³Ø¹Ø±: ${product.price} Ø¬Ù†ÙŠÙ‡ Ù„Ù„Ù…ØªØ±</p>
                    <p>Ø§Ù„Ø­Ø§Ù„Ø©: ${product.active ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'}</p>
                    <p>Ø§Ù„Ù…ØµØ¯Ø±: ${product._id && product._id.length > 10 ? 'Firebase' : 'Ù…Ø­Ù„ÙŠ'}</p>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-warning" onclick="editProduct('${product._id}')">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn btn-danger" onclick="deleteProductConfirm('${product._id}')">Ø­Ø°Ù</button>
                    </div>
                `;
                container.appendChild(productCard);
            });
        }

        function loadAdminOrders() {
            const container = document.getElementById('ordersContainer');
            container.innerHTML = '';

            const recentOrders = orders.slice(0, 5);
            recentOrders.forEach(order => {
                const orderCard = document.createElement('div');
                orderCard.className = 'product-card';
                orderCard.innerHTML = `
                    <h4>Ø·Ù„Ø¨ #${order.orderNumber}</h4>
                    <p>Ø§Ù„Ù…Ù†ØªØ¬: ${order.productName}</p>
                    <p>Ø§Ù„Ù…Ù‚Ø§Ø³: ${order.length} Ã— ${order.width} Ø³Ù…</p>
                    <p>Ø§Ù„ÙƒÙ…ÙŠØ©: ${order.quantity} Ø§Ø³ØªÙŠÙƒØ±</p>
                    <p>Ø§Ù„Ø³Ø¹Ø±: ${order.totalPrice} Ø¬Ù†ÙŠÙ‡</p>
                    <p>Ø§Ù„Ù…ØµØ¯Ø±: ${order._id && order._id.length > 10 ? 'Firebase' : 'Ù…Ø­Ù„ÙŠ'}</p>
                    <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(order.createdAt).toLocaleDateString('ar-EG')}</p>
                `;
                container.appendChild(orderCard);
            });
        }

        function updateStats() {
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('totalOrders').textContent = orders.length;
            const totalRevenue = orders.reduce((sum, order) => sum + order.totalPrice, 0);
            document.getElementById('totalRevenue').textContent = totalRevenue.toLocaleString();
        }

        // ğŸ”¥ Authentication
        function adminLogin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;

            if (email === 'admin@mydeal.com' && password === 'admin123') {
                isAdminLoggedIn = true;
                currentUser = { email: email, role: 'admin' };
                localStorage.setItem(STORAGE_KEYS.ADMIN_LOGGED_IN, 'true');
                loginModal.style.display = 'none';
                adminSection.style.display = 'block';
                adminLink.style.display = 'none';
                logoutLink.style.display = 'block';
                loadAdminProducts();
                loadAdminOrders();
                updateStats();
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
            } else {
                showNotification('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©', true);
            }
        }

        function adminLogout() {
            isAdminLoggedIn = false;
            currentUser = null;
            localStorage.setItem(STORAGE_KEYS.ADMIN_LOGGED_IN, 'false');
            adminSection.style.display = 'none';
            adminLink.style.display = 'block';
            logoutLink.style.display = 'none';
            showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬');
        }

        // ğŸ”¥ Price Calculation
        function calculatePrice() {
            const productType = document.getElementById('productType').value;
            const length = parseFloat(document.getElementById('length').value);
            const width = parseFloat(document.getElementById('width').value);
            const quantity = document.getElementById('quantity').value;

            if (!productType || !length || !width) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', true);
                return;
            }

            const product = products.find(p => p.type === productType);
            if (!product) {
                showNotification('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', true);
                return;
            }

            let price = 0;
            let steps = [];
            const pricePerMeter = product.price;

            if (['thermal', 'white', 'plastic'].includes(productType)) {
                price = (length * width * pricePerMeter) / 1000;
                steps.push(`Ø§Ù„Ø·ÙˆÙ„ (${length} Ø³Ù…) Ã— Ø§Ù„Ø¹Ø±Ø¶ (${width} Ø³Ù…) Ã— Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ± (${pricePerMeter} Ø¬Ù†ÙŠÙ‡) = ${(length * width * pricePerMeter).toLocaleString()} Ø¬Ù†ÙŠÙ‡`);
                steps.push(`Ù†Ù‚Ø³Ù… Ø¹Ù„Ù‰ 1000 = ${price.toLocaleString()} Ø¬Ù†ÙŠÙ‡`);
            } else if (['wax', 'resin', 'wax-resin'].includes(productType)) {
                price = (width * length * pricePerMeter);
                steps.push(`Ø§Ù„Ø¹Ø±Ø¶ (${width} Ø³Ù…) Ã— Ø§Ù„Ø·ÙˆÙ„ (${length} Ø³Ù…) Ã— Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ± (${pricePerMeter} Ø¬Ù†ÙŠÙ‡) = ${price.toLocaleString()} Ø¬Ù†ÙŠÙ‡`);
            }

            if (quantity === "500") {
                price = price / 2;
                steps.push(`Ù†Ù‚Ø³Ù… Ø¹Ù„Ù‰ 2 = ${price.toLocaleString()} Ø¬Ù†ÙŠÙ‡`);
            } else if (quantity === "2000") {
                price = price * 2;
                steps.push(`Ù†Ø¶Ø±Ø¨ ÙÙŠ 2 = ${price.toLocaleString()} Ø¬Ù†ÙŠÙ‡`);
            }

            const finalPrice = Math.round(price);
            document.getElementById('priceValue').textContent = finalPrice.toLocaleString() + ' Ø¬Ù†ÙŠÙ‡';
            document.getElementById('selectedLength').textContent = length + ' Ø³Ù…';
            document.getElementById('selectedWidth').textContent = width + ' Ø³Ù…';
            document.getElementById('selectedQuantity').textContent = quantity + ' Ø§Ø³ØªÙŠÙƒØ±';
            document.getElementById('pricePerMeter').textContent = pricePerMeter + ' Ø¬Ù†ÙŠÙ‡';

            const stepsContent = document.getElementById('stepsContent');
            stepsContent.innerHTML = steps.map(step => `<div class="step">${step}</div>`).join('');
            document.getElementById('calculationSteps').style.display = 'block';

            const orderData = {
                productName: product.name,
                productType: productType,
                length: length,
                width: width,
                quantity: quantity,
                unitPrice: pricePerMeter,
                totalPrice: finalPrice,
                createdAt: new Date().toISOString(),
                orderNumber: 'ORD-' + Date.now()
            };
            
            createOrder(orderData);
            showNotification(`ØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø±: ${finalPrice.toLocaleString()} Ø¬Ù†ÙŠÙ‡`);
        }

        // ğŸ”¥ WhatsApp Integration
        function sendWhatsAppMessage() {
            if (!currentOrder) {
                showNotification('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ø­Ø§Ù„ÙŠØ§Ù‹', true);
                return;
            }

            const phoneNumber = "201008559292";
            const message = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡ Ù…Ù† Mydeal:

Ø§Ù„Ù…Ù†ØªØ¬: ${currentOrder.productName}
Ø§Ù„Ù…Ù‚Ø§Ø³: ${currentOrder.length} Ã— ${currentOrder.width} Ø³Ù…
Ø§Ù„ÙƒÙ…ÙŠØ©: ${currentOrder.quantity} Ø§Ø³ØªÙŠÙƒØ±
Ø§Ù„Ù…Ø¨Ù„Øº: ${currentOrder.totalPrice} Ø¬Ù†ÙŠÙ‡
Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${currentOrder.orderNumber}

ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¯ÙØ¹ ÙˆØªÙ†ÙÙŠØ° Ø§Ù„Ø·Ù„Ø¨. Ø´ÙƒØ±Ø§Ù‹!`;

            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
            showNotification('Ø¬Ø§Ø±Ù ÙØªØ­ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹');
        }

        // Helper Functions
        function showLoading() {
            loadingElement.style.display = 'block';
        }

        function hideLoading() {
            loadingElement.style.display = 'none';
        }

        function showNotification(message, isError = false) {
            notificationText.textContent = message;
            notification.className = 'notification' + (isError ? ' error' : '');
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 4000);
        }

        function populateProductSelect() {
            const select = document.getElementById('productType');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬</option>';
            
            products.filter(p => p.active).forEach(product => {
                const option = document.createElement('option');
                option.value = product.type;
                option.textContent = `${product.name} - ${product.price} Ø¬Ù†ÙŠÙ‡/Ù…ØªØ±`;
                select.appendChild(option);
            });
        }

        function getProductTypeName(type) {
            const types = {
                'thermal': 'ÙˆØ±Ù‚ Ø­Ø±Ø§Ø±ÙŠ',
                'wax': 'Ø±ÙŠØ¨ÙˆÙ† Ø´Ù…Ø¹ÙŠ',
                'resin': 'Ø±ÙŠØ¨ÙˆÙ† Ø±ÙŠØ²ÙŠÙ†',
                'wax-resin': 'Ø±ÙŠØ¨ÙˆÙ† Ø´Ù…Ø¹ÙŠ Ø±ÙŠØ²ÙŠÙ†',
                'white': 'ÙˆØ±Ù‚ Ø£Ø¨ÙŠØ¶ Ù†ØµÙ Ù„Ø§Ù…Ø¹',
                'plastic': 'Ø¨Ù„Ø§Ø³ØªÙŠÙƒ'
            };
            return types[type] || type;
        }

        function deleteProductConfirm(productId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) {
                deleteProduct(productId);
            }
        }

        function closeLogin() {
            loginModal.style.display = 'none';
        }

        // Event Listeners
        adminLink.addEventListener('click', (e) => {
            e.preventDefault();
            loginModal.style.display = 'flex';
        });

        logoutLink.addEventListener('click', (e) => {
            e.preventDefault();
            adminLogout();
        });

        ['length', 'width', 'quantity'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculatePrice);
        });

        document.getElementById('productType').addEventListener('change', calculatePrice);

        // Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
            loadOrders();
            
            document.getElementById('length').value = '103';
            document.getElementById('width').value = '153';
        });

        setInterval(() => {
            loadProducts();
            loadOrders();
        }, 30000);
    </script>
</body>
</html>
